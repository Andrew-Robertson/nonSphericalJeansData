# nonSphericalJeansData
Code to generate the simulation data associated with the paper "Jeans Model for Self-interacting Dark Matter Halo Shapes". Note that the code uses [EAGLE-50](https://ui.adsabs.harvard.edu/abs/2021MNRAS.501.4610R/abstract) simulation data stored on Durham University's [COSMA supercomputer](https://cosma.readthedocs.io/en/latest/) and is unfortunately not currently publicly available. The code is provided here as a reference of what was done, as well as to allow people to generate similar data from other simulations. If you would like access to the raw data please contact Andrew Robertson (andrew.a.robertson91@gmail.com) and I can try to get you an account on COSMA and access to the relevant files.

The data used for the Jeans model paper was generated by running:
```
python simData/scripts/generateCylindricalDensityAndPotentialData.py CDMb
python simData/scripts/generateCylindricalDensityAndPotentialData.py SIDM1b
python simData/scripts/generateCylindricalDensityAndPotentialData.py vdSIDMb

python simData/scripts/generateShapeProfiles.py CDMb
python simData/scripts/generateShapeProfiles.py SIDM1b
python simData/scripts/generateShapeProfiles.py vdSIDMb

python simData/scripts/generateDensityProfiles.py CDMb
python simData/scripts/generateDensityProfiles.py SIDM1b
python simData/scripts/generateDensityProfiles.py vdSIDMb
```
The `generateCylindricalDensityAndPotentialData.py` script generates spherically averaged and azimuthally averaged density data (for stars, dark matter, gas, etc.) as well as gravitational potential data (calculated from the azimuthally averaged density, i.e. assuming cylindrical symmetry). The `generateShapeProfiles.py` script generates shape data as a function of radius, i.e. $q(r)$. Note that the $z$-axis used for the cylindrical coordinates is set by the direction of the stellar angular momentum vector (so should be approximately normal to the disk in the case of disky galaxies). The `generateDensityProfiles.py` script generate spherically averaged density profiles, as well as enclosed mass profiles.

### Public data
The data generated by the above scripts was in the form of `.npz` files, with a separate file for each halo. To make the output easier to manage, and supply some metadata, these were curated into `.hdf5` files using the following scripts:
```
simData/scripts/curateCylindricalData.py
simData/scripts/curateShapeProfileData.py
simData/scripts/curateDensityProfileData.py
```
The resulting files are available for download on Zenodo (or will be soon!). Each dataset in the file has `description` and `units` attributes. 

### Halo matching 

At times, it is useful to compare "the same halo" in different dark matter models. For this purpose there are also "matching files" between each pair of the 3 simulations for which the density, potential and shape data were generated. These matching files were generated with:
```
python simData/scripts/generateHaloMatchingFiles.py CDMb SIDM1b
python simData/scripts/generateHaloMatchingFiles.py CDMb vdSIDMb
python simData/scripts/generateHaloMatchingFiles.py SIDM1b vdSIDMb
```
and can be found in the `simData/haloMatchingData` directory.

Note that not all haloes can be succesfully matched (the matching is done with a strict "bijective" criteria, and can fail when - for example - two halos are just about to merge in one simulation but have already merged in another). Our matching algorithm should have high purity, at the cost of potentially missing halos that could reasonably be matched. The fact that not all halos have matches means that one can't easily match across more than two simulations, and that the `GalaxyID` associated with a particular pair of `CDMb-SIDM1b` matched halos will not necessarily be the same as the `GalaxyID` of "the same" halo matched between `CDMb` and `vdSIDMb`.

